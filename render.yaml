services:
  # Janus Gateway - OpenAI-compatible proxy
  - type: web
    name: janus-gateway
    runtime: python
    plan: free
    region: oregon
    branch: main
    rootDir: gateway
    buildCommand: pip install -e .
    startCommand: uvicorn janus_gateway.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: JANUS_DEBUG
        value: "false"
      - key: JANUS_LOG_FORMAT
        value: "json"
      - key: BASELINE_URL
        fromService:
          type: web
          name: janus-baseline-agent
          property: hostport
          envVarKey: BASELINE_URL
      - key: BASELINE_LANGCHAIN_URL
        fromService:
          type: web
          name: janus-baseline-langchain
          property: hostport
          envVarKey: BASELINE_LANGCHAIN_URL
      - key: CHUTES_API_KEY
        sync: false
    healthCheckPath: /health

  # Janus Baseline Agent - Reference competitor implementation
  - type: web
    name: janus-baseline-agent
    runtime: python
    plan: starter
    region: oregon
    branch: main
    rootDir: baseline-agent-cli
    buildCommand: pip install -e .
    startCommand: uvicorn janus_baseline_agent_cli.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.7"
      - key: BASELINE_DEBUG
        value: "false"
      - key: BASELINE_MODEL
        value: "moonshotai/Kimi-K2-Instruct"
      - key: BASELINE_OPENAI_API_KEY
        sync: false
      - key: BASELINE_OPENAI_BASE_URL
        value: "https://llm.chutes.ai/v1"
      - key: CHUTES_API_KEY
        sync: false
    healthCheckPath: /health

  # Janus Baseline LangChain - Alternative competitor implementation
  - type: web
    name: janus-baseline-langchain
    runtime: python
    plan: free
    region: oregon
    branch: main
    rootDir: baseline-langchain
    buildCommand: pip install -e .
    startCommand: uvicorn janus_baseline_langchain.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: BASELINE_LANGCHAIN_DEBUG
        value: "false"
      - key: BASELINE_LANGCHAIN_OPENAI_API_KEY
        sync: false
      - key: BASELINE_LANGCHAIN_CHUTES_API_KEY
        sync: false
      - key: BASELINE_LANGCHAIN_TAVILY_API_KEY
        sync: false
    healthCheckPath: /health

  # Janus Scoring Service - Benchmark evaluation backend
  - type: web
    name: janus-scoring-service
    runtime: python
    plan: starter
    region: oregon
    branch: main
    rootDir: scoring-service
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn scoring_service.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: DATABASE_URL
        sync: false
      - key: SANDY_API_URL
        value: "https://sandbox.janus.rodeo"
      - key: JUDGE_URL
        sync: false
      - key: JUDGE_API_KEY
        sync: false
      - key: SCORING_MAX_CONCURRENT_RUNS
        value: "5"
    healthCheckPath: /health

  # Janus Chat UI - Next.js frontend
  - type: web
    name: janus-ui
    runtime: node
    plan: free
    region: oregon
    branch: main
    rootDir: ui
    buildCommand: npm install && npm run build
    startCommand: npm run start -- --port $PORT
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: NEXT_PUBLIC_GATEWAY_URL
        fromService:
          type: web
          name: janus-gateway
          property: host
          envVarKey: NEXT_PUBLIC_GATEWAY_URL
      - key: NEXT_PUBLIC_ENABLE_VOICE_INPUT
        value: "true"
      - key: CHUTES_OAUTH_CLIENT_ID
        sync: false
      - key: CHUTES_OAUTH_CLIENT_SECRET
        sync: false
      - key: CHUTES_OAUTH_REDIRECT_URI
        sync: false
      - key: CHUTES_OAUTH_COOKIE_SECRET
        sync: false
    healthCheckPath: /
